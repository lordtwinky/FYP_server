"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var request_1 = require("../request");
var PREFIXES_MAP = {
    'http://www.ontologydesignpatterns.org/ont/dul/DUL.owl#': 'dul',
    'http://dbpedia.org/ontology/': 'dbo',
    'http://www.w3.org/2002/07/owl#': 'owl',
    'http://www.wikidata.org/entity/': 'wikidata',
    'http://schema.org/': 'schema',
    'http://xmlns.com/foaf/0.1/': 'foaf',
    'http://www.w3.org/2003/01/geo/wgs84_pos#': 'geo'
};
var PREFIXES = Object.keys(PREFIXES_MAP).map(function (key) { return PREFIXES_MAP[key]; });
var PREFIXES_REG = new RegExp('^(' + Object.keys(PREFIXES_MAP).join('|') + ')');
function getEntityTypes(id, prefixes) {
    if (!prefixes || !prefixes.length) {
        prefixes = PREFIXES;
    }
    return dbpediaWikidataTypes(id)
        .then(function (types) { return parseTypes(types); })
        .then(function (types) {
        return types.filter(function (item) { return PREFIXES_REG.test(item); })
            .map(function (item) {
            var key = PREFIXES_REG.exec(item)[1];
            return PREFIXES_MAP[key] + ':' + item.substr(key.length);
        });
    });
}
exports.getEntityTypes = getEntityTypes;
function parseTypes(types) {
    return types.map(function (item) { return item.type.value; });
}
function dbpediaWikidataTypes(id) {
    var query = "PREFIX dbpedia-wikidata: <http://wikidata.dbpedia.org/resource/>\nSELECT ?type\nWHERE {\ndbpedia-wikidata:" + id + " rdf:type ?type\n}";
    return request_1.default({ url: 'http://wikidata.dbpedia.org/sparql', qs: { query: query } })
        .then(function (data) { return data.results && data.results.bindings; });
}
function dbpediaTypes(name) {
    var query = "PREFIX dbr: <http://dbpedia.org/resource/>\nSELECT ?type\nWHERE {\ndbr:" + name.replace(/\s+/, ' ') + " rdf:type ?type\n}";
    return request_1.default({ url: 'http://dbpedia.org/sparql', qs: { query: query } })
        .then(function (data) { return data.results && data.results.bindings; });
}
